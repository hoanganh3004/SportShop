<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Th√™m s·∫£n ph·∫©m</title>
    <link rel="stylesheet" th:href="@{/assets/vendor/css/core.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/css/theme-default.css}" />
    <style>
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .image-preview img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        .file-input-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        .file-input-label {
            display: block;
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s;
        }
        .file-input-label:hover {
            background-color: #0056b3;
        }
        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="modal-header">
    <h5 class="modal-title">Th√™m s·∫£n ph·∫©m m·ªõi</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
    <!-- Hi·ªÉn th·ªã th√¥ng b√°o -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle"></i> <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle"></i> <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <form th:action="@{/adproduct/save}" method="post" enctype="multipart/form-data" id="addProductForm">
        <div class="mb-3">
            <label class="form-label">M√£ s·∫£n ph·∫©m</label>
            <input type="text" class="form-control" name="masp" maxlength="50" required/>
        </div>

        <div class="mb-3">
            <label class="form-label">T√™n s·∫£n ph·∫©m</label>
            <input type="text" class="form-control" name="name" maxlength="255" required/>
        </div>

        <div class="mb-3">
            <label class="form-label">Gi√°</label>
            <input type="number" class="form-control" name="price" step="0.01" min="0" max="999999999" required/>
        </div>

        <div class="mb-3">
            <label class="form-label">M√¥ t·∫£</label>
            <textarea class="form-control" name="description" rows="3" maxlength="1000"></textarea>
        </div>

        <div class="mb-3">
            <label class="form-label">Size</label>
            <input type="text" class="form-control" name="size" maxlength="20"/>
        </div>

        <div class="mb-3">
            <label class="form-label">M√†u s·∫Øc</label>
            <input type="text" class="form-control" name="color" maxlength="50"/>
        </div>

        <div class="mb-3">
            <label class="form-label">S·ªë l∆∞·ª£ng</label>
            <input type="number" class="form-control" name="quantity" min="0" max="999999" required/>
        </div>

        <div class="mb-3">
            <label class="form-label">Danh m·ª•c</label>
            <select class="form-select" name="categoryId">
                <option value="">-- Ch·ªçn danh m·ª•c --</option>
                <option th:each="category : ${categories}"
                        th:value="${category.id}"
                        th:text="${category.name}"></option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">H√¨nh ·∫£nh s·∫£n ph·∫©m</label>
            <div class="file-input-container">
                <label for="newImages" class="file-input-label">
                    üì∑ Ch·ªçn nhi·ªÅu ·∫£nh (Ctrl + Click ƒë·ªÉ ch·ªçn nhi·ªÅu)
                </label>
                <input type="file"
                       id="newImages"
                       name="newImages"
                       class="file-input"
                       multiple
                       accept="image/*"
                       onchange="previewImages(this)"/>
            </div>
            <small class="form-text text-muted">
                Ch·∫•p nh·∫≠n: JPG, PNG, GIF, BMP, WEBP. T·ªëi ƒëa 5MB m·ªói file.
            </small>
            <div id="imagePreview" class="image-preview"></div>
        </div>

        <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="submitBtn">
                <i class="fas fa-plus-circle"></i> Th√™m s·∫£n ph·∫©m
            </button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="fas fa-times"></i> ƒê√≥ng
            </button>
        </div>
    </form>
</div>

<script>
    function previewImages(input) {
        const preview = document.getElementById('imagePreview');
        preview.innerHTML = '';

        if (input.files) {
            Array.from(input.files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = file.name;
                        img.title = file.name;
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // C·∫≠p nh·∫≠t label
        const label = document.querySelector('.file-input-label');
        const fileCount = input.files.length;
        if (fileCount > 0) {
            label.textContent = `üì∑ ƒê√£ ch·ªçn ${fileCount} ·∫£nh`;
        } else {
            label.textContent = 'üì∑ Ch·ªçn nhi·ªÅu ·∫£nh (Ctrl + Click ƒë·ªÉ ch·ªçn nhi·ªÅu)';
        }
    }

    // X·ª≠ l√Ω form submission
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('addProductForm');
        const submitBtn = document.getElementById('submitBtn');

        form.addEventListener('submit', function(e) {
            // Hi·ªÉn th·ªã loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang th√™m...';

            // Validate form tr∆∞·ªõc khi submit
            const name = form.querySelector('input[name="name"]').value.trim();
            const masp = form.querySelector('input[name="masp"]').value.trim();
            const price = form.querySelector('input[name="price"]').value;
            const quantity = form.querySelector('input[name="quantity"]').value;
            const images = form.querySelector('input[name="newImages"]').files;

            if (!name) {
                e.preventDefault();
                alert('Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m!');
                resetSubmitButton();
                return;
            }

            if (!masp) {
                e.preventDefault();
                alert('Vui l√≤ng nh·∫≠p m√£ s·∫£n ph·∫©m!');
                resetSubmitButton();
                return;
            }

            if (!price || parseFloat(price) <= 0) {
                e.preventDefault();
                alert('Vui l√≤ng nh·∫≠p gi√° s·∫£n ph·∫©m h·ª£p l·ªá!');
                resetSubmitButton();
                return;
            }

            if (!quantity || parseInt(quantity) < 0) {
                e.preventDefault();
                alert('Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng h·ª£p l·ªá!');
                resetSubmitButton();
                return;
            }

            if (!images || images.length === 0) {
                e.preventDefault();
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ·∫£nh!');
                resetSubmitButton();
                return;
            }
        });

        function resetSubmitButton() {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Th√™m s·∫£n ph·∫©m';
        }
    });
</script>
</body>
</html>