



<h1 class="h3 mb-4 text-gray-800">üì¢ Qu·∫£n l√Ω th√¥ng b√°o</h1>

<!-- ‚úÖ Th√¥ng b√°o khi g·ª≠i th√†nh c√¥ng -->
<c:if test="${not empty sessionScope.msg}">
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="fas fa-check-circle mr-2"></i> ${sessionScope.msg}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <c:remove var="msg" scope="session" />
</c:if>

<!-- Form t√¨m ki·∫øm -->
<form action="admin-notification" method="get" class="form-inline mb-3">
  <input type="text" name="keyword" class="form-control rounded-pill mr-2 shadow-sm"
         placeholder="T√¨m theo n·ªôi dung..." value="${param.keyword}">
  <button type="submit" class="btn btn-primary rounded-pill px-4">
    <i class="fas fa-search"></i> T√¨m ki·∫øm
  </button>
  <button type="button" class="btn btn-success ml-2 rounded-pill px-4" onclick="openCreateNotificationModal()">
    <i class="fas fa-plus"></i> T·∫°o th√¥ng b√°o
  </button>
</form>

<!-- Danh s√°ch th√¥ng b√°o -->
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
    <tr>
      <th>STT</th>
      <th>Ng∆∞·ªùi nh·∫≠n</th>
      <th>N·ªôi dung</th>
      <th>Ng√†y t·∫°o</th>
      <th>ƒê√£ ƒë·ªçc</th>
    </tr>
    </thead>
    <tbody>
    <c:set var="startIndex" value="${(currentPage - 1) * pageSize}" />
    <c:forEach var="n" items="${notificationList}" varStatus="loop">
      <tr>
        <td>${startIndex + loop.index + 1}</td>
        <td>${n.fullName}</td>
        <td>${n.message}</td>
        <td>${n.createdAt}</td>
        <td>
          <c:choose>
            <c:when test="${n.read}">‚úîÔ∏è</c:when>
            <c:otherwise>‚ùå</c:otherwise>
          </c:choose>
        </td>
      </tr>
    </c:forEach>
    </tbody>
  </table>
</div>
<!-- Ph√¢n trang -->
<c:set var="start" value="${currentPage - 2 < 1 ? 1 : currentPage - 2}" />
<c:set var="end" value="${currentPage + 2 > totalPage ? totalPage : currentPage + 2}" />

<nav>
  <ul class="pagination justify-content-center">
    <li class="page-item ${currentPage == 1 ? 'disabled' : ''}">
      <a class="page-link" href="admin-notification?page=${currentPage - 1}&keyword=${keyword}">¬´</a>
    </li>

    <c:if test="${start > 1}">
      <li class="page-item"><a class="page-link" href="admin-notification?page=1&keyword=${keyword}">1</a></li>
      <li class="page-item disabled"><span class="page-link">...</span></li>
    </c:if>

    <c:forEach begin="${start}" end="${end}" var="i">
      <li class="page-item ${i == currentPage ? 'active' : ''}">
        <a class="page-link" href="admin-notification?page=${i}&keyword=${keyword}">${i}</a>
      </li>
    </c:forEach>

    <c:if test="${end < totalPage}">
      <li class="page-item disabled"><span class="page-link">...</span></li>
      <li class="page-item"><a class="page-link" href="admin-notification?page=${totalPage}&keyword=${keyword}">${totalPage}</a></li>
    </c:if>

    <li class="page-item ${currentPage == totalPage ? 'disabled' : ''}">
      <a class="page-link" href="admin-notification?page=${currentPage + 1}&keyword=${keyword}">¬ª</a>
    </li>
  </ul>
</nav>

<!-- Modal t·∫°o th√¥ng b√°o -->
<div class="modal fade" id="createNotificationModal" tabindex="-1" role="dialog"
     aria-labelledby="createModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- AJAX s·∫Ω load n·ªôi dung v√†o ƒë√¢y -->
      <div class="modal-body" id="createNotificationContent"></div>
    </div>
  </div>
</div>

<!-- jQuery & Bootstrap JS -->
<script src="${pageContext.request.contextPath}/vendor/jquery/jquery.min.js"></script>
<script src="${pageContext.request.contextPath}/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<script>
  const contextPath = '${pageContext.request.contextPath}/';

  function openCreateNotificationModal() {
    $.get(contextPath + "create-notification", function (data) {
      $('#createNotificationContent').html(data);
      $('#createNotificationModal').modal('show');
    }).fail(function () {
      alert('Kh√¥ng th·ªÉ t·∫£i form t·∫°o th√¥ng b√°o. Vui l√≤ng th·ª≠ l·∫°i.');
    });
  }
</script>
